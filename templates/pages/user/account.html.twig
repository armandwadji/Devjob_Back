{% extends "base.html.twig" %}

{% block title %}Mon compte{% endblock %}

{% block body %}
	<main class="container mt-5">
		<section class="row g-0  rounded overflow-hidden flex-md-row mb-4 h-md-250 position-relative">
			<div class="col p-4 d-flex flex-column position-static">
				<h3 class="mb-0 text-capitalize">{{user.company.name}}</h3>
				<strong class="d-inline-block mb-2 text-primary">{{user.company.country|country_name}}</strong>
				<p class="card-text mb-auto">Color :
					{{user.company.color}}
				</p>
				<h4 class="card-text mb-auto">Contact :</h4>
				<p class="ms-3">{{user.firstname ~  ' ' ~ user.lastname}}</p>
				<a href="#" class="stretched-link ms-3 ">{{user.email}}</a>
			</div>
			<div class="col-auto d-lg-block rounded-circle p-2" style=" background-color:{{user.company.color}}">
				<img class='rounded-circle' style="width: 100%; height: 100%; max-height: 250px; max-width: 250px; object-fit: contain " src="{% if vich_uploader_asset(user.company, 'imageFile') %} {{vich_uploader_asset(user.company, 'imageFile')}} {% else %} https://picsum.photos/id/{{user.company.id}}/250/250 {% endif %}" alt="Logo de {{user.company.name}}">
			</div>
		</section>
		<hr>

		{% if app.user and 'ROLE_ADMIN' in app.user.roles %}
			<section>

				{% include 'partials/_flash.html.twig' %}
				<a href="{{path('admin.offer.new', {'id': user.company.id , } )}}" class="btn btn-primary mt-4">Ajouter une offre</a>

				{% if user.company.offer|length == 0 %}
					<h4 class='mt-4'>Cette entreprise n'a pas encore d'annonces.</h4>
				{% else %}
					{# total items count #}
					<div class="count mt-4">
						<h5>Cette entreprise à {{ user.company.offer|length }} annonces au total</h5>
					</div>

					<table class="table table-hover">
						<thead>
							<tr>
								<th scope="col" class="text-center">Offre</th>
								<th scope="col" class="text-center">contrat</th>
								<th scope="col" class="text-center">Posté Le</th>
								<th scope="col" class="text-center">Candidats</th>
								<th scope="col" class="text-center">Edité</th>
								<th scope="col" class="text-center">Supprimé</th>
							</tr>
						</thead>
						<tbody>
							{% for offer in user.company.offer %}
								<tr	class="table-primary">
									<td scope="row" class="text-center">{{offer.name}}</td>
									<td scope="row" class="text-center">{{offer.contract}}</td>
									<td scope="row" class="text-center">{{offer.createdAt | date('d/m/Y')}}</td>
									<td scope="row" class="text-center">
										<a href="{{ path('admin.offer.show', {offer: offer.id})}}" class="btn {{offer.candidates|length == 0 ? 'btn-secondary': 'btn-success'}} ">
											{{offer.candidates|length}}
										</a>
									</td>
									<td scope="row" class="text-center">
										<a href="{{path('admin.offer.update', {offer: offer.id} )}}" class="btn btn-info">
											<i class="fa-solid fa-pencil"></i>
										</a>
									</td>
									<td scope="row" class="text-center">
										{% include "partials/_delete_form.html.twig" with 
											{
												link: 'admin.offer.delete', 
												query: { offer: offer.id, count: user.company.offer|length, idCompany : user.company.id }, 
												id: offer.id,
												message : 'Etes vous sur de vouloir supprimé cette offre ?'
											} 
										%}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% endif %}
			</section>
		{% endif %}

	</main>
{% endblock %}
